<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Dashboard Personal</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <!-- Font Awesome para iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        /* Estilos CSS (todo el CSS anterior va aquí) */
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f4f4f4;
            color: #333;
            margin: 0;
            padding: 0;
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .buttons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
        }

        .btn {
            padding: 12px 25px;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            text-decoration: none;
            color: white;
        }

        .btn-primary { background-color: #3498db; }
        .btn-secondary { background-color: #2ecc71; }
        .btn-download { background-color: #e67e22; }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        .bookmarks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .category {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: transform 0.2s ease;
        }

        .category:hover {
            transform: translateY(-5px);
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            color: white;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
        }

        .add-icon {
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: background-color 0.3s;
        }

        .add-icon:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .bookmark-list {
            padding: 10px;
        }

        .bookmark {
            display: flex;
            align-items: center;
            padding: 10px;
            text-decoration: none;
            color: #333;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        .bookmark:hover {
            background-color: #f0f0f0;
        }

        .bookmark-icon {
            margin-right: 10px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            padding: 20px;
            width: 90%;
            max-width: 600px;
            position: relative;
        }

        .close {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .close:hover {
            color: #333;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input[type="text"],
        .form-group input[type="url"],
        .form-group input[type="color"],
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        .form-group select {
            cursor: pointer;
        }

        .btn-add {
            width: 100%;
            background-color: #27ae60;
            margin-top: 10px;
        }

        .category-item,
        .bookmark-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 5px;
            border-bottom: 1px solid #eee;
        }

        .category-actions button,
        .bookmark-actions button {
            margin-left: 5px;
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            color: white;
            background-color: #3498db;
        }

        .category-actions button:nth-child(2),
        .bookmark-actions button:nth-child(2) {
            background-color: #e74c3c;
        }

        .category-actions button:nth-child(3),
        .category-actions button:nth-child(4) {
            background-color: #7f8c8d;
        }

        .footer {
            text-align: center;
            padding: 20px;
            margin-top: auto;
            color: #777;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .buttons {
                flex-direction: column;
            }
            .modal-content {
                width: 95%;
            }
            .bookmarks-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1><i class="fas fa-tachometer-alt"></i> Mi Dashboard Personal</h1>
            <p class="subtitle">Organiza tus enlaces favoritos</p>
        </header>

        <div class="buttons">
            <button class="btn btn-primary" onclick="openCategoryManagerModal()"><i class="fas fa-folder-plus"></i> Gestionar Categorías</button>
            <button class="btn btn-secondary" onclick="openBookmarkManagerModal()"><i class="fas fa-bookmark"></i> Gestionar Marcadores</button>
            <button class="btn btn-download" onclick="downloadUpdatedHTML()"><i class="fas fa-download"></i> Descargar HTML</button>
        </div>

        <main id="bookmarksGrid" class="bookmarks-grid">
            <!-- Las categorías y marcadores se insertarán aquí -->
        </main>
    </div>

    <!-- Modal para gestionar categorías -->
    <div id="categoryManagerModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCategoryManagerModal()">×</span>
            <h2><i class="fas fa-folder-open"></i> Gestionar Categorías</h2>
            <form id="newCategoryForm">
                <div class="form-group">
                    <label for="newCategoryName">Nombre de la categoría:</label>
                    <input type="text" id="newCategoryName" placeholder="Ej. Trabajo" required>
                </div>
                <div class="form-group">
                    <label for="newCategoryColor">Color:</label>
                    <input type="color" id="newCategoryColor" value="#3498db">
                </div>
                <button type="submit" class="btn btn-add"><i class="fas fa-plus-circle"></i> Añadir Categoría</button>
            </form>
            <div id="categoriesList">
                <!-- Lista de categorías -->
            </div>
        </div>
    </div>

    <!-- Modal para añadir marcador -->
    <div id="newBookmarkModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeNewBookmarkModal()">×</span>
            <h2><i class="fas fa-plus"></i> Añadir Marcador</h2>
            <form id="newBookmarkForm">
                <div class="form-group">
                    <label for="bookmarkTitle">Título:</label>
                    <input type="text" id="bookmarkTitle" placeholder="Ej. Google" required>
                </div>
                <div class="form-group">
                    <label for="bookmarkURL">URL:</label>
                    <input type="url" id="bookmarkURL" placeholder="https://www.google.com" required>
                </div>
                <div class="form-group">
                    <label for="bookmarkIcon">Icono (URL o SVG):</label>
                    <input type="text" id="bookmarkIcon" placeholder="URL o código SVG">
                </div>
                <button type="submit" class="btn btn-add"><i class="fas fa-bookmark"></i> Añadir Marcador</button>
            </form>
        </div>
    </div>

    <!-- Modal para gestionar marcadores -->
    <div id="bookmarkManagerModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeBookmarkManagerModal()">×</span>
            <h2><i class="fas fa-bookmark"></i> Gestionar Marcadores</h2>
            <div class="form-group">
                <label for="bookmarkCategoryList">Selecciona una categoría:</label>
                 <select id="bookmarkCategoryList" onchange="selectCategoryForBookmarks(this.value)">
                    <option value="">-- Seleccione --</option>
                    <!-- Opciones generadas dinámicamente -->
                 </select>

            </div>

            <div id="bookmarksList">
                <!-- Lista de marcadores -->
            </div>
        </div>
    </div>

    <footer class="footer">
        <p>Creado por ElVarto7 - 2025</p>
    </footer>

    <script>
        // JavaScript (todo el código JavaScript anterior va aquí)

        document.addEventListener('DOMContentLoaded', () => {
            loadCategories();
            renderCategories();
            renderBookmarkCategoryList(); // Asegúrate de que esto se llame aquí
        });

        let categories = [];
        let selectedCategoryName = null;
        let selectedCategoryForBookmarks = null;

        const defaultCategories = [
            {
                "id": 1,
                "name": "Trabajo",
                "color": "#3498db",
                "bookmarks": [
                    {
                        "title": "Gmail Corporativo",
                        "url": "https://mail.google.com",
                        "icon": "<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z\"></path><polyline points=\"22,6 12,13 2,6\"></polyline></svg>"
                    }
                ]
            },
            {
                "id": 2,
                "name": "Viajes",
                "color": "#e67e22",
                "bookmarks": [
                    {
                        "title": "Booking.com",
                        "url": "https://booking.com",
                        "icon": "<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M2 12h20\"></path><path d=\"M6 4v16\"></path><path d=\"M18 4v16\"></path><path d=\"M6 4h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z\"></path></svg>"
                    }
                ]
            },
            {
                "id": 3,
                "name": "Redes Sociales y Comunicación",
                "color": "#ff6f61",
                "bookmarks": [
                    {
                        "title": "YouTube",
                        "url": "https://youtube.com",
                        "icon": "<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z\"></path><polygon points=\"9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02\"></polygon></svg>"
                    },
                    {
                        "title": "WhatsApp",
                        "url": "https://whatsapp.com",
                        "icon": "<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M12 2a10 10 0 0 0-8.84 14.77L2 22l5.23-1.37A10 10 0 1 0 12 2zm3.84 13.32c-.22.62-.87 1.14-1.53 1.44-.66.3-1.53.35-2.31-.14-.88-.55-1.87-1.43-2.63-2.31-.76-.88-.96-1.92-.76-2.95.18-.9.62-1.73 1.28-2.32.22-.2.44-.3.66-.3.22 0 .44.1.62.3.22.2.44.62.62 1 .18.38.22.82.12 1.24-.1.42-.32.82-.54 1.14-.22.32-.44.64-.32.96.12.32.54 1.14 1.19 1.73.66.58 1.31.96 1.84 1.08.52.12.96-.1 1.28-.32.32-.22.64-.54.86-.86.22-.32.22-.62.18-.86-.04-.24-.22-.48-.44-.62-.22-.14-.44-.3-.66-.48z\"/></svg>"
                    },
                    {
                        "title": "Twitch",
                        "url": "https://twitch.tv",
                        "icon": "<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M21 2H3v16h5v4l4-4h5l4-4V2zm-10 9V7m5 4V7\"/></svg>"
                    }
                ]
            },
            {
                "id": 4,
                "name": "IA y Productividad",
                "color": "#00c4b4",
                "bookmarks": [
                    {
                        "title": "Gmail",
                        "url": "https://mail.google.com",
                        "icon": "<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0 1.1.9-2 2-2z\"></path><polyline points=\"22,6 12,13 2,6\"></polyline></svg>"
                    },
                    {
                        "title": "ChatGPT",
                        "url": "https://chat.openai.com",
                        "icon": "<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M12 2a10 10 0 0 0-3.16 19.49L12 22l3.16-.51A10 10 0 0 0 12 2zm0 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16zm-1-12h2v6h-2z\"/></svg>"
                    },
                    {
                        "title": "Gemini",
                        "url": "https://gemini.google.com",
                        "icon": "<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20zm0 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16zm-1-12h2v6h-2z\"/></svg>"
                    },
                    {
                        "title": "Claude",
                        "url": "https://claude.ai",
                        "icon": "<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20zm0 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16zm-1-12h2v6h-2z\"/></svg>"
                    },
                    {
                        "title": "Canva",
                        "url": "https://canva.com",
                        "icon": "<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M4 4h16v16H4zM6 6h12v12H6z\"/></svg>"
                    }
                ]
            },
            {
                "id": 5,
                "name": "No Mans Sky",
                "color": "#7b1fa2",
                "bookmarks": [
                    {
                        "title": "NMS Recipes",
                        "url": "https://nomansskyrecipes.com",
                        "icon": "<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20zm0 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16zm-1-12h2v6h-2z\"/></svg>"
                    },
                    {
                        "title": "NMS Expeditions",
                        "url": "https://cwmonkey.github.io/nms-expeditions",
                        "icon": "<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20zm0 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16zm-1-12h2v6h-2z\"/></svg>"
                    }
                ]
            },
            {
                "id": 6,
                "name": "Google",
                "color": "#4285f4",
                "bookmarks": [
                    {
                        "title": "Gmail",
                        "url": "https://mail.google.com",
                        "icon": "<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0 1.1.9-2 2-2z\"></path><polyline points=\"22,6 12,13 2,6\"></polyline></svg>"
                    },
                    {
                        "title": "Drive",
                        "url": "https://drive.google.com",
                        "icon": "<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M12 2L2 8l10 6 10-6-10-6zm0 6l-10 6 10 6 10-6-10-6z\"/></svg>"
                    },
                    {
                        "title": "Keep",
                        "url": "https://keep.google.com",
                        "icon": "<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M4 4h16v12H4zM4 8h16M4 12h16\"/></svg>"
                    },
                    {
                        "title": "Docs",
                        "url": "https://docs.google.com",
                        "icon": "<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"/><polyline points=\"14 2 14 8 20 8\"/></svg>"
                    },
                    {
                        "title": "Sheets",
                        "url": "https://sheets.google.com",
                        "icon": "<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"/><polyline points=\"14 2 14 8 20 8\"/><path d=\"M8 13h8M8 17h8M8 9h8\"/></svg>"
                    }
                ]
            },
            {
                "id": 7,
                "name": "Periódicos",
                "color": "#f4b400",
                "bookmarks": [
                    {
                        "title": "El Correo Digital",
                        "url": "https://elcorreo.com",
                        "icon": "<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M2 4h20v16H2zM2 8h20M2 12h20M2 16h20\"/></svg>"
                    },
                    {
                        "title": "El País",
                        "url": "https://elpais.com",
                        "icon": "<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M2 4h20v16H2zM2 8h20M2 12h20M2 16h20\"/></svg>"
                    }
                ]
            }
        ];

        function loadCategories() {
            const storedCategories = localStorage.getItem('categories');
            if (storedCategories) {
                categories = JSON.parse(storedCategories);
            } else {
                categories = JSON.parse(JSON.stringify(defaultCategories));
            }
            syncCategoriesWithDefault();
            saveCategories();
        }

        function syncCategoriesWithDefault() {
            const defaultMap = new Map(defaultCategories.map(cat => [cat.id, cat]));
            defaultCategories.forEach(defaultCat => {
                const existingIndex = categories.findIndex(cat => cat.id === defaultCat.id);
                if (existingIndex !== -1) {
                    const existingCat = categories[existingIndex];
                    existingCat.name = defaultCat.name;
                    existingCat.color = defaultCat.color;
                    const defaultBookmarksMap = new Map(defaultCat.bookmarks.map(b => [b.url, b]));
                    const updatedBookmarks = [...defaultCat.bookmarks];
                    existingCat.bookmarks.forEach(bookmark => {
                        if (!defaultBookmarksMap.has(bookmark.url)) {
                            updatedBookmarks.push(bookmark);
                        }
                    });
                    existingCat.bookmarks = updatedBookmarks;
                } else {
                    categories.push(JSON.parse(JSON.stringify(defaultCat)));
                }
            });
            categories = categories.filter(cat => defaultMap.has(cat.id));
        }

        function saveCategories() {
            localStorage.setItem('categories', JSON.stringify(categories));
        }

        function renderCategories() {
            const grid = document.getElementById('bookmarksGrid');
            if (!grid) return;
            grid.innerHTML = '';

            categories.forEach(category => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category';
                categoryDiv.setAttribute('data-category', category.name);

                const header = document.createElement('div');
                header.className = 'category-header';
                header.style.background = `linear-gradient(45deg, ${category.color}, ${adjustColor(category.color, -20)})`;
                header.innerHTML = `
                    <span>${category.name}</span>
                    <div class="add-icon" onclick="openNewBookmarkModal('${category.name}')">
                        <i class="fas fa-plus"></i>
                    </div>
                `;
                categoryDiv.appendChild(header);

                const bookmarkList = document.createElement('div');
                bookmarkList.className = 'bookmark-list';
                category.bookmarks.forEach(bookmark => {
                    const a = document.createElement('a');
                    a.href = bookmark.url;
                    a.className = 'bookmark';
                    a.target = '_blank';
                    let iconContent = bookmark.icon;
                    const isSVG = iconContent.trim().startsWith('<svg');
                    if (!isSVG && iconContent.trim() !== '') {
                        iconContent = `<img src="${iconContent}" alt="icon" style="width:24px;height:24px;">`;
                    }
                    a.innerHTML = `
                        <div class="bookmark-icon">${iconContent || ''}</div>
                        <span class="bookmark-title">${bookmark.title}</span>
                    `;
                    bookmarkList.appendChild(a);
                });
                categoryDiv.appendChild(bookmarkList);
                grid.appendChild(categoryDiv);
            });
        }

        function renderCategoryManagementList() {
            const list = document.getElementById('categoriesList');
            if (!list) return;
            list.innerHTML = '';
            categories.forEach((category, index) => {
                const item = document.createElement('div');
                item.className = 'category-item';
                item.innerHTML = `
                    <span>${category.name}</span>
                    <div class="category-actions">
                        <button onclick="editCategory(${index})"><i class="fas fa-edit"></i></button>
                        <button onclick="deleteCategory(${index})"><i class="fas fa-trash-alt"></i></button>
                        <button onclick="moveCategoryUp(${index})"><i class="fas fa-arrow-up"></i></button>
                        <button onclick="moveCategoryDown(${index})"><i class="fas fa-arrow-down"></i></button>
                    </div>
                                `;
                list.appendChild(item);
            });
        }

        function openCategoryManagerModal() {
            renderCategoryManagementList();
            document.getElementById('categoryManagerModal').style.display = 'flex';
        }

        function closeCategoryManagerModal() {
            document.getElementById('categoryManagerModal').style.display = 'none';
        }

        function openNewBookmarkModal(categoryName) {
            selectedCategoryName = categoryName;
            document.getElementById('newBookmarkForm').reset();
            document.getElementById('newBookmarkModal').style.display = 'flex';
        }

        function closeNewBookmarkModal() {
            document.getElementById('newBookmarkModal').style.display = 'none';
        }

        function openBookmarkManagerModal() {
            selectedCategoryForBookmarks = null;
            renderBookmarkCategoryList();  // Asegúrate de que esta función se llame
            document.getElementById('bookmarksList').innerHTML = ''; //Limpia la lista
            document.getElementById('bookmarkManagerModal').style.display = 'flex';
        }

        function closeBookmarkManagerModal() {
            document.getElementById('bookmarkManagerModal').style.display = 'none';
        }
          // Controlador de clic para cerrar modales haciendo clic fuera
        window.onclick = function(event) {
            const categoryModal = document.getElementById('categoryManagerModal');
            const bookmarkModal = document.getElementById('newBookmarkModal');
            const bookmarkManagerModal = document.getElementById('bookmarkManagerModal');

            if (event.target === categoryModal) closeCategoryManagerModal();
            if (event.target === bookmarkModal) closeNewBookmarkModal();
            if (event.target === bookmarkManagerModal) closeBookmarkManagerModal();
        };


        document.getElementById('newCategoryForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const name = document.getElementById('newCategoryName').value.trim();
            const color = document.getElementById('newCategoryColor').value;
            if (name) {
                const newCategory = {
                    id: Date.now(), // ID único para la nueva categoría.
                    name: name,
                    color: color,
                    bookmarks: []
                };
                categories.push(newCategory);
                saveCategories();
                renderCategories();
                renderCategoryManagementList();
                renderBookmarkCategoryList(); // Actualiza la lista en el modal de gestión de marcadores
                closeCategoryManagerModal();
            }
        });

        function editCategory(index) {
            const categoryToEdit = categories[index];
            const newName = prompt("Nuevo nombre para la categoría:", categoryToEdit.name);
            if (newName !== null && newName.trim() !== "") {
                categoryToEdit.name = newName.trim();
                const newColor = prompt("Nuevo color (opcional):", categoryToEdit.color);
                if (newColor !== null) {
                    categoryToEdit.color = newColor;
                }
                saveCategories();
                renderCategories();
                renderCategoryManagementList();
                renderBookmarkCategoryList(); // Actualiza select en gestor de marcadores
            }
        }

        function deleteCategory(index) {
            if (confirm("¿Seguro que quieres eliminar esta categoría?")) {
                categories.splice(index, 1);
                saveCategories();
                renderCategories();
                renderCategoryManagementList();
                renderBookmarkCategoryList(); //  Actualiza el selector
            }
        }

        function moveCategoryUp(index) {
            if (index > 0) {
                [categories[index], categories[index - 1]] = [categories[index - 1], categories[index]];
                saveCategories();
                renderCategories();
                renderCategoryManagementList();
            }
        }

        function moveCategoryDown(index) {
            if (index < categories.length - 1) {
                [categories[index], categories[index + 1]] = [categories[index + 1], categories[index]];
                saveCategories();
                renderCategories();
                renderCategoryManagementList();
            }
        }
        // Evento Submit para añadir nuevo marcador
        document.getElementById('newBookmarkForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const title = document.getElementById('bookmarkTitle').value.trim();
            const url = document.getElementById('bookmarkURL').value.trim();
            const icon = document.getElementById('bookmarkIcon').value.trim();
            if (title && url && selectedCategoryName) {
                const category = categories.find(cat => cat.name === selectedCategoryName);
                if (category) {
                    category.bookmarks.push({ title: title, url: url, icon: icon });
                    saveCategories();
                    renderCategories(); // Actualiza la visualización
                    closeNewBookmarkModal();
                }
            }
        });

        // Renderiza las opciones en el select del modal de gestión de marcadores.
        function renderBookmarkCategoryList() {
            const list = document.getElementById('bookmarkCategoryList');
            if (!list) return;

            list.innerHTML = '<option value="">-- Seleccione --</option>'; // Opción por defecto

            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.name;
                option.textContent = category.name;
                list.appendChild(option);
            });
        }


        function selectCategoryForBookmarks(categoryName) {
            selectedCategoryForBookmarks = categoryName;
            renderBookmarkManagementList(); // Llama a la función para mostrar los marcadores
        }

        function renderBookmarkManagementList() {
            const list = document.getElementById('bookmarksList');
            if (!list || !selectedCategoryForBookmarks) return; // No hace nada si no hay lista o categoría
            list.innerHTML = ''; // Limpia la lista

            const category = categories.find(cat => cat.name === selectedCategoryForBookmarks);
            if (category) {
                category.bookmarks.forEach((bookmark, index) => {
                    const item = document.createElement('div');
                    item.className = 'bookmark-item';
                    item.innerHTML = `
                        <span>${bookmark.title}</span>
                        <div class="bookmark-actions">
                            <button onclick="editBookmark('${selectedCategoryForBookmarks}', ${index})"><i class="fas fa-edit"></i></button>
                            <button onclick="deleteBookmark('${selectedCategoryForBookmarks}', ${index})"><i class="fas fa-trash-alt"></i></button>
                        </div>
                    `;
                    list.appendChild(item);
                });
            }
        }

        function editBookmark(categoryName, index) {
            const category = categories.find(cat => cat.name === categoryName);
            if (!category) return;
            const bookmark = category.bookmarks[index];

            const newTitle = prompt("Nuevo título:", bookmark.title);
            if (newTitle !== null && newTitle.trim() !== "") {
                bookmark.title = newTitle.trim();
            }

            const newUrl = prompt("Nueva URL:", bookmark.url);
            if (newUrl !== null && newUrl.trim() !== "") {
                bookmark.url = newUrl.trim();
            }

            const newIcon = prompt("Nuevo icono (SVG o URL):", bookmark.icon);
            if (newIcon !== null) {
                bookmark.icon = newIcon;
            }

            saveCategories();
            renderCategories();
            renderBookmarkManagementList(); // Actualiza la lista en el modal
        }

        function deleteBookmark(categoryName, index) {
            if (confirm("¿Seguro que quieres eliminar este marcador?")) {
                const category = categories.find(cat => cat.name === categoryName);
                if (category) {
                    category.bookmarks.splice(index, 1);
                    saveCategories();
                    renderCategories();
                    renderBookmarkManagementList(); // Actualiza modal
                }
            }
        }

        function downloadUpdatedHTML() {
            // Actualiza el contenido del select en el HTML antes de la descarga
            const selectElement = document.getElementById('bookmarkCategoryList');
            if(selectElement){ //Verifica si existe
                let selectOptions = '<option value="">-- Seleccione --</option>';
                categories.forEach(category => {
                  selectOptions += `<option value="${category.name}">${category.name}</option>`;
                });
                selectElement.innerHTML = selectOptions;
            }

            const htmlContent = document.documentElement.outerHTML;
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'mi_dashboard_personal.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(a.href); // Libera recursos
        }

        function adjustColor(color, amount) {
            let usePound = false;
            if (color[0] === "#") {
                color = color.slice(1);
                usePound = true;
            }
            const num = parseInt(color, 16);
            let r = (num >> 16) + amount;
            let g = ((num >> 8) & 0x00FF) + amount;
            let b = (num & 0x0000FF) + amount;
            r = Math.max(Math.min(255, r), 0);
            g = Math.max(Math.min(255, g), 0);
            b = Math.max(Math.min(255, b), 0);
            const newColor = (r << 16) | (g << 8) | b;
            return (usePound ? "#" : "") + newColor.toString(16).padStart(6, '0');
        }


    </script>
</body>
</html>
